  // Calculate efficiency weighted exposure 
  // Combines data from two TGraphs with efficiency and Clopper-Pearson error bars
  #include "TMath.h"
  {
    TFile *f1 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch582.root");
    TGraphAsymmErrors *geff1 = (TGraphAsymmErrors*)f1->Get("Graph");
    TFile *f2 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch580.root");
    TGraphAsymmErrors *geff2 = (TGraphAsymmErrors*)f2->Get("Graph");
    TFile *f3 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch578.root");
    TGraphAsymmErrors *geff3 = (TGraphAsymmErrors*)f3->Get("Graph");
    //TFile *f4 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch692.root");
    //TGraphAsymmErrors *geff4 = (TGraphAsymmErrors*)f4->Get("Graph");
    TFile *f5 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch648.root");
    TGraphAsymmErrors *geff5 = (TGraphAsymmErrors*)f5->Get("Graph");
    TFile *f6 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch640.root");
    TGraphAsymmErrors *geff6 = (TGraphAsymmErrors*)f6->Get("Graph");
    TFile *f7 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch610.root");
    TGraphAsymmErrors *geff7 = (TGraphAsymmErrors*)f7->Get("Graph");
    TFile *f8 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch608.root");
    TGraphAsymmErrors *geff8 = (TGraphAsymmErrors*)f8->Get("Graph");
    TFile *f9 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch664.root");
    TGraphAsymmErrors *geff9 = (TGraphAsymmErrors*)f9->Get("Graph");
    //TFile *f10 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch624.root");
    //TGraphAsymmErrors *geff10 = (TGraphAsymmErrors*)f10->Get("Graph");
    //TFile *f11 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch694.root");
    //TGraphAsymmErrors *geff11 = (TGraphAsymmErrors*)f11->Get("Graph");
    //TFile *f12 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch614.root");
    //TGraphAsymmErrors *geff12 = (TGraphAsymmErrors*)f12->Get("Graph");
    TFile *f13 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch678.root");
    TGraphAsymmErrors *geff13 = (TGraphAsymmErrors*)f13->Get("Graph");
    TFile *f14 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch672.root");
    TGraphAsymmErrors *geff14 = (TGraphAsymmErrors*)f14->Get("Graph");
    TFile *f15 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch632.root");
    TGraphAsymmErrors *geff15 = (TGraphAsymmErrors*)f15->Get("Graph");
    TFile *f16 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch626.root");
    TGraphAsymmErrors *geff16 = (TGraphAsymmErrors*)f16->Get("Graph");
    TFile *f17 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch690.root");
    TGraphAsymmErrors *geff17 = (TGraphAsymmErrors*)f17->Get("Graph");
    //TFile *f18 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch600.root");
    //TGraphAsymmErrors *geff18 = (TGraphAsymmErrors*)f18->Get("Graph");
    TFile *f19 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch598.root");
    TGraphAsymmErrors *geff19 = (TGraphAsymmErrors*)f19->Get("Graph");
    TFile *f20 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch594.root");
    TGraphAsymmErrors *geff20 = (TGraphAsymmErrors*)f20->Get("Graph");
    TFile *f21 = new TFile("~/LowE/Data/IndivEfficiencies/ClopperErrorDS1Ch592.root");
    TGraphAsymmErrors *geff21 = (TGraphAsymmErrors*)f21->Get("Graph");
      
    cout << "Loading data files" << endl;

    double eff1[20] = {};
    double eff2[20] = {};
    double eff3[20] = {};
    //double eff4[20] = {};
    double eff5[20] = {};
    double eff6[20] = {};
    double eff7[20] = {};
    double eff8[20] = {};
    double eff9[20] = {};
    //double eff10[20] = {};
    //double eff11[20] = {};
    //double eff12[20] = {};
    double eff13[20] = {};
    double eff14[20] = {};
    double eff15[20] = {};
    double eff16[20] = {};
    double eff17[20] = {};
    //double eff18[20] = {};
    double eff19[20] = {};
    double eff20[20] = {};
    double eff21[20] = {};
    double effSum[20] = {};
    double errhi1[20] = {};
    double errlow1[20] = {};
    double errhi2[20] = {};
    double errlow2[20] = {};
    double errhi3[20] = {};
    double errlow3[20] = {};
    //double errhi4[20] = {};
    //double errlow4[20] = {};
    double errhi5[20] = {};
    double errlow5[20] = {};
    double errhi6[20] = {};
    double errlow6[20] = {};
    double errhi7[20] = {};
    double errlow7[20] = {};
    double errhi8[20] = {};
    double errlow8[20] = {};
    double errhi9[20] = {};
    double errlow9[20] = {};
    //double errhi10[20] = {};
    //double errlow10[20] = {};
    //double errhi11[20] = {};
    //double errlow11[20] = {};
    //double errhi12[20] = {};
    //double errlow12[20] = {};
    double errhi13[20] = {};
    double errlow13[20] = {};
    double errhi14[20] = {};
    double errlow14[20] = {};
    double errhi15[20] = {};
    double errlow15[20] = {};
    double errhi16[20] = {};
    double errlow16[20] = {};
    double errhi17[20] = {};
    double errlow17[20] = {};
    //double errhi18[20] = {};
    //double errlow18[20] = {};
    double errhi19[20] = {};
    double errlow19[20] = {};
    double errhi20[20] = {};
    double errlow20[20] = {};
    double errhi21[20] = {};
    double errlow21[20] = {};
    double errSumhi[20] = {};
    double errSumlow[20] = {};
    double x[20] = {};
    double xerr[20] = {};
    cout << "Initializing arrays" << endl;

    double LT = ;
    double LT1 = 29.5795;
    double M1 = 0.979;
    double errM1 = 0.013;
    double LT2 = 28.6320;
    double M2 = 0.811;
    double errM2 = 0.012;
    double LT3 = 29.5789;
    double M3 = 0.968;
    double errM3 = 0.013;
    //double M4 = 0.560;
    //double errM4 = 0.013;
    double LT5 = 28.0681;
    double M5 = 0.723;
    double errM5 = 0.011;
    double LT6 = 29.0160;
    double M6 = 0.659;
    double errM6 = 0.011;
    double LT7 = 28.5925;
    double M7 = 0.886;
    double errM7 = 0.012;
    double LT8 = 28.5927;
    double M8 = 0.949;
    double errM8 = 0.013;
    double LT9 = 28.5926;
    double M9 = 1.024;
    double errM9 = 0.014;
    //double M10 = 0.558;
    //double errM10 = 0.013;
    //double M11 = 0.545;
    //double errM11 = 0.012;
    //double M12 = 0.557;
    //double errM12 = 0.013;
    double LT13 = 29.5845;
    double M13 = 0.730;
    double errM13 = 0.011;
    double LT14 = 29.5826;
    double M14 = 0.632;
    double errM14 = 0.011;
    double LT15 = 29.4943;
    double M15 = 0.732;
    double errM15 = 0.011;
    double LT16 = 29.5856;
    double M16 = 0.701;
    double errM16 = 0.011;
    double LT17 = 29.5843;
    double M17 = 0.5722;
    double errM17 = 0.0094;
    //double M18 = 0.561;
    //double errM18 = 0.013;
    double LT19 = 29.5814;
    double M19 = 0.710;
    double errM19 = 0.011;
    double LT20 = 29.5808;
    double M20 = 0.5908;
    double errM20 = 0.009;
    double LT21 = 29.5845;
    double M21 = 0.964;
    double errM21 = 0.013;
    

    cout << "Beginning loop" << endl;
    for(int i = 0; i < 20; i++)
    {
	eff1[i] = geff1->Eval(i*5);
	eff2[i] = geff2->Eval(i*5);
    eff3[i] = geff3->Eval(i*5);
    //eff4[i] = geff4->Eval(i*5);
    eff5[i] = geff5->Eval(i*5);
    eff6[i] = geff6->Eval(i*5);
    eff7[i] = geff7->Eval(i*5);
    eff8[i] = geff8->Eval(i*5);
    eff9[i] = geff9->Eval(i*5);
    //eff10[i] = geff10->Eval(i*5);
    //eff11[i] = geff11->Eval(i*5);
    //eff12[i] = geff12->Eval(i*5);
    eff13[i] = geff13->Eval(i*5);
    eff14[i] = geff14->Eval(i*5);
    eff15[i] = geff15->Eval(i*5);
    eff16[i] = geff16->Eval(i*5);
    eff17[i] = geff17->Eval(i*5);
    //eff18[i] = geff18->Eval(i*5);
    eff19[i] = geff19->Eval(i*5);
    eff20[i] = geff20->Eval(i*5);
    eff21[i] = geff21->Eval(i*5);
	errhi1[i] = geff1->GetErrorYhigh(i);
	errlow1[i] = geff1->GetErrorYlow(i);
	errhi2[i] = geff2->GetErrorYhigh(i);
    errlow2[i] = geff2->GetErrorYlow(i);
    errhi3[i] = geff3->GetErrorYhigh(i);
    errlow3[i] = geff3->GetErrorYlow(i);
    //errhi4[i] = geff4->GetErrorYhigh(i);
    //errlow4[i] = geff4->GetErrorYlow(i);
    errhi5[i] = geff5->GetErrorYhigh(i);
    errlow5[i] = geff5->GetErrorYlow(i);
    errhi6[i] = geff6->GetErrorYhigh(i);
    errlow6[i] = geff6->GetErrorYlow(i);
    errhi7[i] = geff7->GetErrorYhigh(i);
    errlow7[i] = geff7->GetErrorYlow(i);
    errhi8[i] = geff8->GetErrorYhigh(i);
    errlow8[i] = geff8->GetErrorYlow(i);
    errhi9[i] = geff9->GetErrorYhigh(i);
    errlow9[i] = geff9->GetErrorYlow(i);
    //errhi10[i] = geff10->GetErrorYhigh(i);
    //errlow10[i] = geff10->GetErrorYlow(i);
    //errhi11[i] = geff11->GetErrorYhigh(i);
    //errlow11[i] = geff11->GetErrorYlow(i);
    //errhi12[i] = geff12->GetErrorYhigh(i);
    //errlow12[i] = geff12->GetErrorYlow(i);
    errhi13[i] = geff13->GetErrorYhigh(i);
    errlow13[i] = geff13->GetErrorYlow(i);
    errhi14[i] = geff14->GetErrorYhigh(i);
    errlow14[i] = geff14->GetErrorYlow(i);
    errhi15[i] = geff15->GetErrorYhigh(i);
    errlow15[i] = geff15->GetErrorYlow(i);
    errhi16[i] = geff16->GetErrorYhigh(i);
    errlow16[i] = geff16->GetErrorYlow(i);
    errhi17[i] = geff17->GetErrorYhigh(i);
    errlow17[i] = geff17->GetErrorYlow(i);
    //errhi18[i] = geff18->GetErrorYhigh(i);
    //errlow18[i] = geff18->GetErrorYlow(i);
    errhi19[i] = geff19->GetErrorYhigh(i);
    errlow19[i] = geff19->GetErrorYlow(i);
    errhi20[i] = geff20->GetErrorYhigh(i);
    errlow20[i] = geff20->GetErrorYlow(i);
    errhi21[i] = geff21->GetErrorYhigh(i);
    errlow21[i] = geff21->GetErrorYlow(i);
    effSum[i] = (LT1*M1*eff1[i]) + (LT2*M2*eff2[i]) + (LT3*M3*eff3[i]) + (LT5*M5*eff5[i]) + (LT6*M6*eff6[i]) + (LT7*M7*eff7[i]) + (LT8*M8*eff8[i]) + (LT9*M9*eff9[i]) + (LT13*M13*eff13[i]) + (LT14*M14*eff14[i]) + (LT15*M15*eff15[i]) + (LT16*M16*eff16[i]) + (LT17*M17*eff17[i]) + (LT19*M19*eff19[i])  + (LT20*M20*eff20[i])  + (LT21*M21*eff21[i]);
    errSumhi[i] = sqrt(((errhi1[i]*M1*LT1)*(errhi1[i]*M1*LT1)) + ((errM1*eff1[i]*LT1)*(errM1*eff1[i]*LT1)) + ((errhi2[i]*M2*LT2)*(errhi2[i]*M2*LT2)) + ((errM2*eff2[i]*LT2)*(errM2*eff2[i]*LT2)) + ((errhi3[i]*M3*LT3)*(errhi3[i]*M3*LT3)) + ((errM3*eff3[i]*LT3)*(errM3*eff3[i]*LT3)) + ((errhi5[i]*M5*LT5)*(errhi5[i]*M5*LT5)) + ((errM5*eff5[i]*LT5)*(errM5*eff5[i]*LT5)) + ((errhi6[i]*M6*LT6)*(errhi6[i]*M6*LT6)) + ((errM6*eff6[i]*LT6)*(errM6*eff6[i]*LT6)) + ((errhi7[i]*M7*LT7)*(errhi7[i]*M7*LT7)) + ((errM7*eff7[i]*LT7)*(errM7*eff7[i]*LT7)) + ((errhi8[i]*M8*LT8)*(errhi8[i]*M8*LT8)) + ((errM8*eff8[i]*LT8)*(errM8*eff8[i]*LT8)) + ((errhi9[i]*M9*LT9)*(errhi9[i]*M9*LT9)) + ((errM9*eff9[i]*LT9)*(errM9*eff9[i]*LT9)) + ((errhi13[i]*M13*LT13)*(errhi13[i]*M13*LT13)) + ((errM13*eff13[i]*LT13)*(errM13*eff13[i]*LT13)) + ((errhi14[i]*M14*LT14)*(errhi14[i]*M14*LT14)) + ((errM14*eff14[i]*LT14)*(errM14*eff14[i]*LT14)) + ((errhi15[i]*M15*LT15)*(errhi15[i]*M5*LT15)) + ((errM15*eff15[i]*LT15)*(errM15*eff15[i]*LT15)) + ((errhi16[i]*M16*LT16)*(errhi16[i]*M16*LT16)) + ((errM16*eff16[i]*LT16)*(errM16*eff16[i]*LT16)) + ((errhi17[i]*M17*LT17)*(errhi17[i]*M17*LT17)) + ((errM17*eff17[i]*LT17)*(errM17*eff17[i]*LT17)) + ((errhi19[i]*M19*LT19)*(errhi19[i]*M19*LT19)) + ((errM19*eff19[i]*LT19)*(errM19*eff19[i]*LT19)) + ((errhi20[i]*M20*LT20)*(errhi20[i]*M20*LT20)) + ((errM20*eff20[i]*LT20)*(errM20*eff20[i]*LT20)) + ((errhi21[i]*M21*LT21)*(errhi21[i]*M21*LT21)) + ((errM21*eff21[i]*LT21)*(errM21*eff21[i]*LT21)));
    errSumlow[i] = sqrt(((errlow1[i]*M1*LT1)*(errlow1[i]*M1*LT1)) + ((errM1*eff1[i]*LT1)*(errM1*eff1[i]*LT1)) + ((errlow2[i]*M2*LT2)*(errlow2[i]*M2*LT2)) + ((errM2*eff2[i]*LT2)*(errM2*eff2[i]*LT2)) + ((errlow3[i]*M3*LT3)*(errlow3[i]*M3*LT3)) + ((errM3*eff3[i]*LT3)*(errM3*eff3[i]*LT3)) + ((errlow5[i]*M5*LT5)*(errlow5[i]*M5*LT5)) + ((errM5*eff5[i]*LT5)*(errM5*eff5[i]*LT5)) + ((errlow6[i]*M6*LT6)*(errlow6[i]*M6*LT6)) + ((errM6*eff6[i]*LT6)*(errM6*eff6[i]*LT6)) + ((errlow7[i]*M7*LT7)*(errlow7[i]*M7*LT7)) + ((errM7*eff7[i]*LT7)*(errM7*eff7[i]*LT7)) + ((errlow8[i]*M8*LT8)*(errlow8[i]*M8*LT8)) + ((errM8*eff8[i]*LT8)*(errM8*eff8[i]*LT8)) + ((errlow9[i]*M9*LT9)*(errlow9[i]*M9*LT9)) + ((errM9*eff9[i]*LT9)*(errM9*eff9[i]*LT9)) + ((errlow13[i]*M13*LT13)*(errlow13[i]*M13*LT13)) + ((errM13*eff13[i]*LT13)*(errM13*eff13[i]*LT13)) + ((errlow14[i]*M14*LT14)*(errlow14[i]*M14*LT14)) + ((errM14*eff14[i]*LT14)*(errM14*eff14[i]*LT14)) + ((errlow15[i]*M15*LT15)*(errlow15[i]*M15*LT15)) + ((errM15*eff15[i]*LT15)*(errM15*eff15[i]*LT15)) + ((errlow16[i]*M16*LT16)*(errlow16[i]*M16*LT16)) + ((errM16*eff16[i]*LT16)*(errM16*eff16[i]*LT16)) + ((errlow17[i]*M17*LT17)*(errlow17[i]*M17*LT17)) + ((errM17*eff17[i]*LT17)*(errM17*eff17[i]*LT17)) + ((errlow19[i]*M19*LT19)*(errlow19[i]*M19*LT19)) + ((errM19*eff19[i]*LT19)*(errM19*eff19[i]*LT19)) + ((errlow20[i]*M20*LT20)*(errlow20[i]*M20*LT20)) + ((errM20*eff20[i]*LT20)*(errM20*eff20[i]*LT20)) + ((errlow21[i]*M21*LT21)*(errlow21[i]*M21*LT21)) + ((errM21*eff21[i]*LT21)*(errM21*eff21[i]*LT21)));
	x[i] = i*5;
    xerr[i] = 0;
    }
    cout << "Loop ended" << endl;

    f1->Close();
    f2->Close();
    f3->Close();
    //f4->Close();
    f5->Close();
    f6->Close();
    f7->Close();
    f8->Close();
    f9->Close();
    //f10->Close();
    //f11->Close();
    //f12->Close();
    f13->Close();
    f14->Close();
    f15->Close();
    f16->Close();
    f17->Close();
    //f18->Close();
    f19->Close();
    f20->Close();
    f21->Close();
    cout << "Data files closed" << endl;

    string outFile = "~/LowE/Data/CombinedEfficiencies/ClopperErrorDS3Combined.root";
    TFile *f0 = new TFile(outFile.c_str(),"recreate");
    cout << "Creating outpout file" <<  endl;
    f0->cd();

    cout << "Creating new TGraph" << endl;
    TGraphAsymmErrors *geffSum = new TGraphAsymmErrors(20, x, effSum, xerr, xerr, errSumlow, errSumhi);
    //TGraph *geffSum =  new TGraph(20,x,effSum);
    TCanvas *c2 = new TCanvas("c2","c2",800,600);
    geffSum->SetMarkerStyle(21);
    geffSum->SetMarkerColor(kRed);
    geffSum->SetTitle("DS3 efficiency weighted exposure");
    geffSum->GetXaxis()->SetTitle("trapENFCal (keV)");
    geffSum->GetYaxis()->SetTitle("eff wt expos (kg*d)");
    //geffSum->Draw("AP");
    geffSum->Write();
    f0->Close();
    cout << "Finished" << endl;
  }
